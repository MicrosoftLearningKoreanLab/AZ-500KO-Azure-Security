---
lab:
    title: 'LAB 01_모니터 & Autoscale'
    module: '모듈 02 - 플랫폼 보호'
---

# 랩: 모니터 & Autoscale

Autoscale은 클라우드 서비스, 모바일 서비스, 가상 머신(Virtual Machine) 및 웹 사이트의 내장 기능으로, 수요가 변화할 때 애플리케이션이 최상의 성능을 발휘할 수 있도록 합니다. 물론 성능은 애플리케이션마다 다릅니다. 어떤 앱은 CPU에 기반하고, 다른 앱은 메모리에 기반합니다. 예를 들어, 낮에는 수백만 건의 요청을 처리하고 밤에는 아무것도 처리하지 않는 웹 앱을 가질 수 있습니다. Autoscale은 이들 중 하나 또는 사용자 정의 메트릭에 따라 서비스를 확장할 수 있습니다.


## 연습 1: 랩 환경 구성

1.  웹 브라우저 창에서 다음 URL로 접속한다. 

    https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FMicrosoftLearning%2FAZ-500-Azure-Security%2Fmaster%2FAllfiles%2FLabs%2FMod2_Lab01%2Ftemplate.json

    이를 통해  AZ500 Mod2 Lab 1에서 확장 옵션을 실습하는 데 사용할 수 있는 새로운 앱과 App Service 계획을 템플릿으로 배포한다.

1.  리소스 그룹 **새로 만들기**를 선택한다.

1.  **Site Name** 과 **Service Plan** 이름을 고유한 이름으로 입력한다.

1.  **위에 명시된 사용 약관에 동의함** 체크박스에 체크를 한 후 **구매**버튼을 클릭합니다.


## 연습 2: Autoscale 설정 

간단한 단계별 작업을 통해 첫 번째 Autoscale 설정을 만듭니다.

1.  Azure 포털에서 **모니터**를 검색하고, 왼쪽 메뉴에서 **자동 크기 조정**을 클릭한다. `연습 1`에서 생성한 구독과 리소스 그룹을 선택하여 생성된 App Service Plan을 선택합니다.

1.  현재 인스턴스 수가 1개인 것을 확인하고, **사용자 지정 자동 크기 조정**을 클릭한다.

1.  자동 크기 조정 설정 이름을 입력하고, **+ 규칙 추가**를 클릭한다.

1.  오른쪽의 컨텍스트 창이 열리면 크기 조정 규칙을 확인한다. 기본적으로 리소스의 CPU 백분율이 70%를 초과하는 경우 인스턴스 수를 1씩 추가하는 옵션을 설정한다. 기본값을 그대로 유지하고 **추가**를 클릭한다.

1.  이제 첫 번째 크기 조정 규칙을 생성하였습니다. UI는 모범 사례를 권장하며 "규칙에 배율이 하나 이상 있는 것이 좋습니다. 하이퍼링크를 클릭하여 새 규칙을 만들 수 있습니다"라고 명시하고 있다. 다음 설정을 사용하여 규칙을 추가한다.

    - **규칙 추가** 클릭

    - **연산자** : **보다 작음**

    - **크기 조정 작업을 트리거하는 메트릭 임계값** : **20**

    - **작업** : **다음을 기준으로 개수 줄이기**

1.  **추가**를 클릭한다.

1.  상단에 **저장**을 클릭하여 자동 크기 조정 설정을 저장합니다.

    **참고**: "Microsoft.insights not registered"(추가 버튼이 회색으로 표시됨) 오류가 표시되면 구독 블레이드로 이동하고 리소스 공급자에서 "Microsoft.insights"를 등록하고, 몇 분 정도 기다린 후 다시 시도하십시오. 등록되지 않으면 **연습 3**을 진행합니다.

이로써 CPU 사용량을 기준으로 한 자동 크기 조정 설정을 만들었습니다.


## 연습 3: 일정 기반 크기 조정

CPU를 기반으로 한 확장뿐만 아니라 특정 요일에 따른 확장도 설정할 수 있습니다.

1.  **자동 크기 조정 설정 블레이드**에서 **크기 조건 추가**를 클릭한다.

1.  크기 조정 모드 및 규칙은 기본 조건과 동일하게 설정한다.

1.  **특정 일 반복**을 선택한다.

1.  크기 조정 조건을 적용해야 하는 날짜와 시작/종료 시간을 선택한다.


## 연습 4: 특정한 날짜에 따라 크기 조정

CPU를 기반으로 한 확장뿐만 아니라 특정 날짜에 대한 확장도 다르게 설정할 수 있습니다.

1.  **자동 크기 조정 설정 블레이드**에서 **크기 조건 추가**를 클릭한다.

1.  크기 조정 모드 및 규칙은 기본 조건과 동일하게 설정한다.

1.  **일정** 항목의 **시작/종료 날짜 지정** 을 선택한다.

1.  확장 조건을 적용할 시작/종료 날짜와 시작/종료 시간을 선택하고, **저장**을 클릭한다.


## 연습 5:  리소스의 크기 조정 기록 확인

1.  리소스가 확장되거나 축소될 때마다 작업 로그에 이벤트가 기록된다. **실행 기록** 탭으로 전환하여 지난 24시간 동안 리소스의 확장 기록을 볼 수 있다.

1.  전체 크기 조정 기록을 보려면(최대 90일) **활동 로그에서 자세한 내용 확인**을 선택한다. 활동 로그 블레이드가 열리고 리소스 및 범주에 대해 미리 선택된 자동 크기 조정 로그가 나타난다.


## 연습 6: 리소스의 크기 조정 정의 확인

1.  자동 확장(Autoscale)은 Azure Resource Manager 리소스다. **JSON** 탭으로 전환하여 확장에 대한 정의를 볼 수 있다.

1.  필요한 경우 **JSON**에서 직접 설정을 변경할 수 있다. 이러한 변경사항은 저장한 후에 반영된다.


| 경고: 계속하기 전에 이 랩에 사용된 모든 리소스를 제거하십시오. **Azure 포털**에서 이 작업을 수행하려면 **리소스 그룹**을 클릭하십시오. 생성한 리소스 그룹을 선택하고, **리소스 그룹 삭제**를 누른 후 리소스 그룹 이름을 입력하여 **삭제**를 누르십시오. 생성한 추가 리소스 그룹에 대해 이 과정을 반복하십시오. **이 작업을 수행하지 않을 경우 다른 랩에 문제가 발생할 수 있습니다.** |
| --- |
